
# GPT Line Protocol

A human-readable line protocol generated by ChatGPT, which has comparable performance to protobuf, and much better performance than prototext/protojson.

The protocol is designed to be human-readable, option encoding passed by to remote service, and easy to parse.

I wrote a fuzzer to ensure the correctness but is still possible to have bugs. I will not be responsible for any data loss.

+ `line_protocol.Encoder` is for text encoding.

+ `line_protocol.Decoder` is for text decoding.

+ `line_protocol.Query` is for random access to line options.

### Example

A comprehensive example follows:

```go

func encode(next *scheRequest) string {
	var enc = line_protocol.NewEncoder()
	enc.WriteString("action", "start")
	enc.WriteInt64("idx", next.ScheduleIdx)
	enc.WriteInt64("tick", next.ApprovalTick)
	enc.WriteString("task", next.TaskId)
	enc.WriteInt64("time", next.ScheduleTime)
	return enc.Final()
}

func main() {
    var decoder = line_protocol.NewDecoder(encode(&scheRequest{}))
    var action string
    var fieldName string
    if !decoder.Next(&fieldName) || fieldName != "action" || !decoder.StringField(&action) {
        log.Warn().Str("log", logLine).Str("workerId", endpoint.id).Err(decoder.Error()).Msg("Scheduler.LogNotStartWithAction")
        return
    }

    if action != "start" {
        return
    }

    for decoder.Next(&fieldName) {
        switch fieldName {
        case "idx":
            decoder.Int64Field(&scheduleIdx)
        case "tick":
            decoder.Int64Field(&prevLogicTick)
        case "task":
            decoder.StringField(&taskRemoteId)
        case "time":
            decoder.Int64Field(&scheduleTime)
        case "exec":
            decoder.Int64Field(&executedTime)
            log.Warn().Str("log", logLine).Str("workerId", endpoint.id).Msg("Scheduler.StartLogWithExecTime")
        default:
            decoder.WithError(fmt.Errorf("unknown field %s", fieldName))
        }
    }

    if decoder.Error() != nil {
        log.Warn().Str("log", logLine).Str("workerId", endpoint.id).Err(decoder.Error()).Msg("Scheduler.LogParseError")
        return
    }
}
```

### Generation

The README is also generated by ChatGPT.

